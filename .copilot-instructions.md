# TSI Header Extension - Copilot Instructions

## Project Overview

TSI Header is a comprehensive VS Code extension that provides code generation, standardized headers, and study mode functionality for 120+ programming languages. The extension is built with quality assurance as a top priority, featuring 100% test coverage and robust validation.

**Key Features:**
- Code header generation for 120+ languages
- Project scaffolding and boilerplate generation
- Pomodoro-style study timer with work/break phases
- Multi-language support with consistent formatting
- Quality assurance with comprehensive testing

## Architecture Overview

### Core Structure
```
‚îú‚îÄ‚îÄ core/                    # Main extension logic
‚îÇ   ‚îú‚îÄ‚îÄ index.js            # Core interface and exports
‚îÇ   ‚îú‚îÄ‚îÄ generators/         # Code generation modules
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ classGenerators.js    # Class generation logic
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ codeBaseGenerators.js # Codebase generation
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ languages/            # Language-specific generators
‚îÇ   ‚îî‚îÄ‚îÄ src/
‚îÇ       ‚îú‚îÄ‚îÄ extension.js          # Main VS Code extension entry point
‚îÇ       ‚îî‚îÄ‚îÄ studyModeExtension.js # Study mode integration
‚îú‚îÄ‚îÄ lib/                    # Ruby CLI components
‚îú‚îÄ‚îÄ src/                    # Legacy source (being phased out)
‚îú‚îÄ‚îÄ studyMode/              # Pomodoro timer implementation
‚îÇ   ‚îú‚îÄ‚îÄ timer.js            # Core timer logic with monotonic timing
‚îÇ   ‚îú‚îÄ‚îÄ timer.test.js       # Timer unit tests
‚îÇ   ‚îî‚îÄ‚îÄ extension.test.js   # Integration tests
‚îú‚îÄ‚îÄ TEST_Suite/             # Comprehensive test suite
‚îî‚îÄ‚îÄ examples/               # Demo files and examples
```

### Key Components

#### 1. Extension Entry Point (`core/src/extension.js`)
- Main VS Code extension activation
- Command registration and UI integration
- Configuration management
- Study mode initialization

#### 2. Study Mode Timer (`studyMode/timer.js`)
- Pomodoro timer with work/break phases
- **Monotonic timing** using `process.hrtime.bigint()` to prevent timer jumping
- Status bar integration (positioned on the right side)
- Persistence using VS Code's global state
- Audio notifications for phase transitions

#### 3. Code Generators (`core/generators/`)
- **Language Generators**: 120+ language-specific header generators
- **Class Generators**: Object-oriented class creation
- **Project Generators**: Full project scaffolding
- **Build System Generators**: Makefile, CMake, etc.

#### 4. Ruby CLI (`lib/`)
- Command-line interface for header generation
- Compilation and build scripts
- Legacy Ruby-based processing

## Coding Standards & Conventions

### JavaScript/Node.js Standards

#### File Structure
- Use ES6+ syntax with `const`/`let` over `var`
- Export modules using ES6 `export` syntax
- Import with named imports: `import { functionName } from './module'`

#### Naming Conventions
- **Functions**: camelCase (`createHeader`, `formatTime`)
- **Classes**: PascalCase (`StudyModeTimer`, `TSICore`)
- **Constants**: UPPER_SNAKE_CASE (`WORK_DURATION`, `MAX_SESSIONS`)
- **Files**: kebab-case (`study-mode-timer.js`, `code-generators.js`)

#### Code Style
```javascript
// ‚úÖ Good: Clear, descriptive names and consistent formatting
function createProjectStructure(vscode, projectType, language) {
    const config = vscode.workspace.getConfiguration('tsiheader');
    const username = config.get('username');

    if (!username) {
        throw new Error('Username not configured');
    }

    return generateProjectFiles(projectType, language, username);
}

// ‚ùå Bad: Unclear names, inconsistent formatting
function cps(v, pt, l) {
    let c = v.workspace.getConfiguration('tsiheader');
    let u = c.get('username');
    if(!u) throw new Error('no user');
    return genProjFiles(pt, l, u);
}
```

#### Error Handling
- Use specific error messages
- Prefer throwing errors over returning null/undefined
- Use try-catch for external operations (file I/O, API calls)

```javascript
// ‚úÖ Good: Specific error handling
try {
    const content = await vscode.workspace.fs.readFile(fileUri);
    return processContent(content);
} catch (error) {
    throw new Error(`Failed to read file ${fileUri.fsPath}: ${error.message}`);
}
```

### Testing Standards

#### Test Organization
- Tests are located in `TEST_Suite/` for integration tests
- Unit tests are co-located with source files (e.g., `timer.test.js`)
- Use descriptive test names that explain the behavior being tested

#### Test Structure
```javascript
test('StudyModeTimer - Timer Controls', { timeout: 5000 }, async (t) => {
    let timer;
    let mockContext;

    t.beforeEach(() => {
        mockContext = { subscriptions: [], extensionPath: '/test/path' };
        timer = new StudyModeTimer(mockVSCode, mockContext);
    });

    t.afterEach(() => {
        if (timer) timer.dispose();
    });

    await t.test('should start timer and transition to work phase', () => {
        timer.start();
        assert.equal(timer.currentPhase, 'work');
        assert.equal(timer.isRunning, true);
        assert(timer.startTime);
    });
});
```

#### Test Coverage Requirements
- **100% test coverage** is mandatory
- Test both success and failure scenarios
- Mock external dependencies (VS Code API, file system)
- Test edge cases and error conditions

### Ruby Standards (Legacy Components)

#### File Structure
- Use standard Ruby naming conventions
- Classes in `CamelCase`
- Methods in `snake_case`
- Files in `snake_case.rb`

#### Code Style
```ruby
# ‚úÖ Good: Clear Ruby style
class TSIHeaderGenerator
  def initialize(config = {})
    @username = config[:username] || ENV['TSI_USERNAME']
    @email = config[:email] || ENV['TSI_EMAIL']
    validate_configuration
  end

  private

  def validate_configuration
    raise ArgumentError, 'Username is required' if @username.nil?
    raise ArgumentError, 'Email is required' if @email.nil?
  end
end
```

## Development Workflow

### Making Changes

#### 1. Code Generation Features
When adding support for a new language:
- Add language generator in `core/generators/languages/`
- Follow existing patterns from similar languages
- Add comprehensive tests in `TEST_Suite/`
- Update documentation

#### 2. Study Mode Timer
- **Never use `Date.now()`** for timing calculations - use monotonic timing
- Status bar items should be positioned on the **right side**
- Maintain backward compatibility with saved timer state
- Test timer persistence across VS Code restarts

#### 3. Extension Commands
When adding new commands:
- Register in `package.json` contributes.commands
- Implement in `core/src/extension.js`
- Add to appropriate menus/contexts
- Include error handling and user feedback

### Testing Protocol

#### Pre-Commit Requirements
1. **Run full test suite**: `ruby TEST_Suite/full_test_suite.rb`
2. **Verify 100% pass rate** (currently 336 tests)
3. **Test timer functionality**: `node studyMode/timer.test.js`
4. **Package and install locally** to verify extension works (vsce package is installed, PAT for publishing is configured)

#### Test Categories
- **Unit Tests**: Individual component testing
- **Integration Tests**: Full workflow testing
- **Language Tests**: Header generation for all supported languages
- **Timer Tests**: Study mode functionality and persistence

### Common Patterns & Anti-Patterns

#### ‚úÖ Recommended Patterns

**Monotonic Timing (Timer)**
```javascript
// Use process.hrtime.bigint() for accurate timing
this.startHrtime = process.hrtime.bigint();
const elapsed = Number(process.hrtime.bigint() - this.startHrtime) / 1e6; // ms
```

**VS Code API Usage**
```javascript
// Always check for API availability
if (vscode && vscode.window && vscode.window.showInformationMessage) {
    vscode.window.showInformationMessage('Operation completed');
}
```

**Configuration Access**
```javascript
// Use workspace configuration properly
const config = vscode.workspace.getConfiguration('tsiheader');
const username = config.get('username');
const workDuration = config.get('studyMode.workDuration', 25);
```

#### ‚ùå Anti-Patterns to Avoid

**Date.now() for Timing**
```javascript
// ‚ùå Bad: Causes timer jumping on system clock changes
const elapsed = Date.now() - this.startTime;
```

**Direct File System Access**
```javascript
// ‚ùå Bad: Use VS Code workspace APIs instead
const fs = require('fs');
fs.writeFileSync(path, content); // Don't do this
```

**Global State Pollution**
```javascript
// ‚ùå Bad: Don't pollute global namespace
global.timerInstance = this; // Don't do this
```

### Extension-Specific Guidelines

#### Status Bar Integration
- Study mode timer appears on the **right side** of status bar
- Use appropriate icons (üçÖ for work, ‚òï for break, etc.)
- Include tooltips with clear status information
- Handle click events for pause/resume functionality

#### Configuration Management
- All settings under `tsiheader.*` namespace
- Provide sensible defaults
- Validate configuration values
- Show helpful setup instructions for missing config

#### Error Handling & User Experience
- Never crash the extension - handle errors gracefully
- Provide clear, actionable error messages
- Use VS Code's notification system appropriately
- Log errors for debugging but don't expose internals to users

### Performance Considerations

#### Bundle Optimization
- Extension should be bundled to reduce load time
- Exclude unnecessary files via `.vscodeignore`
- Minimize startup activation events

#### Memory Management
- Clean up event listeners and timers
- Dispose of VS Code resources properly
- Avoid memory leaks in long-running operations

#### Timer Accuracy
- Use monotonic timing to prevent drift
- Handle system suspend/resume gracefully
- Maintain accuracy across VS Code restarts

## Quality Assurance

### Code Review Checklist
- [ ] All tests pass (336/336 minimum)
- [ ] No `Date.now()` usage in timing code
- [ ] Status bar items positioned correctly
- [ ] Error handling implemented
- [ ] Configuration validation added
- [ ] Documentation updated
- [ ] Backward compatibility maintained

### Testing Checklist
- [ ] Unit tests for new functionality
- [ ] Integration tests for workflows
- [ ] Timer persistence testing
- [ ] Cross-platform compatibility
- [ ] VS Code version compatibility

This document should be updated as the codebase evolves. Always refer to existing code patterns and maintain consistency with established conventions.