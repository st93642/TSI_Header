{# ************************************************************************* #}
{#                                                                           #}
{#  test_codebase_twig.txt                               TTTTTTTT SSSSSSS II #}
{#                                                          TT    SS      II #}
{#  By: st93642@students.tsi.lv                             TT    SSSSSSS II #}
{#                                                          TT         SS II #}
{#  Created: Sep 30 2025 17:57 st93642                      TT    SSSSSSS II #}
{#  Updated: Sep 30 2025 17:57 st93642                                       #}
{#                                                                           #}
{#   Transport and Telecommunication Institute - Riga, Latvia                #}
{#                       https://tsi.lv                                      #}
{# ************************************************************************* #}

{# Twig Template - PHP Templating Engine #}
{# Comprehensive template demonstrating Twig features #}

{# Template variables and data structures #}
{% set page_title = "Welcome to Twig Templates" %}
{% set user = {
    'name': 'Jane Doe',
    'email': 'jane@example.com',
    'role': 'Designer',
    'active': true,
    'permissions': ['read', 'write', 'admin']
} %}
{% set navigation = [
    {'url': '/', 'title': 'Home', 'active': true},
    {'url': '/about', 'title': 'About', 'active': false},
    {'url': '/portfolio', 'title': 'Portfolio', 'active': false},
    {'url': '/contact', 'title': 'Contact', 'active': false}
] %}

{# Macro definitions #}
{% macro render_navigation(items) %}
{# Navigation menu macro #}
<nav class="navbar">
    <ul class="nav-list">
    {% for item in items %}
        <li class="nav-item{{ item.active ? ' active' : '' }}">
            <a href="{{ item.url }}" class="nav-link">{{ item.title }}</a>
        </li>
    {% endfor %}
    </ul>
</nav>
{% endmacro %}

{% macro user_profile(user_data) %}
{# User profile card macro #}
<div class="user-profile">
    <div class="avatar">
        <img src="{{ user_data.avatar | default('/images/default-avatar.png') }}" alt="{{ user_data.name }}">
    </div>
    <div class="user-info">
        <h3>{{ user_data.name }}</h3>
        <p class="role">{{ user_data.role }}</p>
        <p class="email">{{ user_data.email }}</p>
        <div class="status{{ user_data.active ? ' active' : ' inactive' }}">
            {{ user_data.active ? 'Active' : 'Inactive' }}
        </div>
    </div>
</div>
{% endmacro %}

{# Template inheritance - extending base template #}
{% extends "base.html.twig" %}

{# Block definitions #}
{% block title %}{{ page_title }}{% endblock %}

{% block stylesheets %}
{{ parent() }}
<style>
.user-profile { display: flex; align-items: center; gap: 1rem; }
.status.active { color: green; }
.status.inactive { color: red; }
.feature-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; }
</style>
{% endblock %}

{% block content %}
<div class="container">
    {# Page header with string manipulation #}
    <header class="page-header">
        <h1>{{ page_title | upper }}</h1>
        <p class="subtitle">{{ page_title | lower | replace({'welcome to': 'Exploring'}) }}</p>
        <p class="date">Generated on {{ "now" | date("F j, Y") }}</p>
    </header>

    {# Navigation using macro #}
    {{ render_navigation(navigation) }}

    {# Main content area #}
    <main class="main-content">
        {# Conditional rendering with complex conditions #}
        {% if user.active and user.permissions contains 'admin' %}
            <div class="admin-banner">
                <h2>Welcome back, Administrator {{ user.name | split(' ') | first }}!</h2>
                <p>You have full access to all system features.</p>
            </div>
        {% elseif user.active %}
            <div class="welcome-message">
                <h2>Welcome back, {{ user.name | title }}!</h2>
                <p>It's great to see you again. Here's your personalized dashboard:</p>
            </div>
        {% else %}
            <div class="inactive-message">
                <h2>Account Inactive</h2>
                <p>Please contact support to reactivate your account.</p>
            </div>
        {% endif %}

        {# User profile using macro #}
        {{ user_profile(user) }}

        {# Data iteration with advanced features #}
        <section class="projects-section">
            <h3>Recent Projects</h3>
            <div class="projects-grid">
            {% for project in projects | default([]) %}
                <div class="project-card{{ loop.index is odd ? ' odd' : ' even' }}">
                    <h4>{{ project.title }}</h4>
                    <p>{{ project.description | slice(0, 100) ~ '...' }}</p>
                    <div class="project-meta">
                        <span class="date">{{ project.created_at | date("M j, Y") }}</span>
                        <span class="status status-{{ project.status | lower }}">{{ project.status }}</span>
                    </div>
                    {% if loop.first %}
                        <div class="featured-badge">Featured</div>
                    {% endif %}
                </div>
            {% else %}
                <div class="no-projects">
                    <p>No projects found. <a href="/projects/new">Create your first project</a></p>
                </div>
            {% endfor %}
            </div>
        </section>

        {# Form handling with CSRF protection #}
        <section class="contact-section">
            <h3>Send us a Message</h3>
            <form method="post" action="{{ path('contact_submit') }}">
                <input type="hidden" name="_token" value="{{ csrf_token('contact') }}" />

                <div class="form-group">
                    <label for="name">Full Name:</label>
                    <input type="text" id="name" name="name"
                           value="{{ form_data.name | default('') }}"
                           placeholder="Enter your full name" required>
                </div>

                <div class="form-group">
                    <label for="email">Email Address:</label>
                    <input type="email" id="email" name="email"
                           value="{{ form_data.email | default('') }}"
                           placeholder="your.email@example.com" required>
                </div>

                <div class="form-group">
                    <label for="subject">Subject:</label>
                    <select id="subject" name="subject">
                        {% for subject_option in ['General Inquiry', 'Support', 'Feedback', 'Business'] %}
                        <option value="{{ subject_option | lower | replace({' ': '_'}) }}"
                                {{ form_data.subject | default('') == subject_option | lower | replace({' ': '_'}) ? 'selected' : '' }}>
                            {{ subject_option }}
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="message">Message:</label>
                    <textarea id="message" name="message" rows="5"
                              placeholder="Tell us how we can help you...">{{ form_data.message | default('') }}</textarea>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Send Message</button>
                    <button type="reset" class="btn btn-secondary">Reset Form</button>
                </div>
            </form>
        </section>

        {# Advanced Twig features demonstration #}
        <section class="advanced-features">
            <h3>Twig Advanced Features</h3>

            {# Batch processing #}
            <div class="feature-showcase">
                <h4>Batch Processing</h4>
                {% set items = ['a', 'b', 'c', 'd', 'e', 'f', 'g'] %}
                {% for batch in items | batch(3) %}
                    <div class="batch">
                        {% for item in batch %}
                            <span class="item">{{ item | upper }}</span>
                        {% endfor %}
                    </div>
                {% endfor %}
            </div>

            {# Mathematical operations and formatting #}
            <div class="calculations">
                <h4>Calculations & Formatting</h4>
                {% set total_items = navigation | length %}
                {% set completed_percentage = 75 %}
                {% set price = 29.99 %}

                <p>Total navigation items: {{ total_items }}</p>
                <p>Completed: {{ completed_percentage }}%</p>
                <p>Progress: {{ completed_percentage / 100 * 100 | number_format(1) }}%</p>
                <p>Price: {{ price | format_currency('USD', locale='en') }}</p>
                <p>Items per page: {{ items_per_page | default(12) }}</p>
                <p>Total pages: {{ (total_items / (items_per_page | default(12))) | round(0, 'ceil') }}</p>
            </div>

            {# Date and time manipulation #}
            <div class="date-examples">
                <h4>Date & Time Examples</h4>
                {% set now = date() %}
                {% set tomorrow = now | date_modify('+1 day') %}
                {% set last_week = now | date_modify('-1 week') %}

                <p>Current date: {{ now | date('F j, Y') }}</p>
                <p>Tomorrow: {{ tomorrow | date('l, F j, Y') }}</p>
                <p>Last week: {{ last_week | date('M j') }}</p>
                <p>Days until end of month: {{ now | date('t') - now | date('j') }}</p>
            </div>

            {# Array and object manipulation #}
            <div class="data-manipulation">
                <h4>Data Manipulation</h4>
                {% set numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10] %}
                {% set words = ['apple', 'banana', 'cherry', 'date'] %}

                <p>Numbers: {{ numbers | join(', ') }}</p>
                <p>Even numbers: {{ numbers | filter(v => v % 2 == 0) | join(', ') }}</p>
                <p>Words starting with 'a': {{ words | filter(v => v starts with 'a') | join(', ') }}</p>
                <p>Reversed words: {{ words | reverse | join(' -> ') }}</p>
                <p>Random word: {{ random(words) }}</p>
                <p>Sum of numbers: {{ numbers | reduce((carry, v) => carry + v) }}</p>
            </div>
        </section>

        {# Include other templates #}
        <section class="includes-section">
            <h3>Template Includes</h3>
            <div class="includes-grid">
                {% include 'components/sidebar.html.twig' with {'active_section': 'dashboard'} %}
                {% include 'components/footer.html.twig' %}
            </div>
        </section>
    </main>

    {# Sidebar with embedded templates #}
    <aside class="sidebar">
        {% embed 'components/sidebar.html.twig' %}
            {% block sidebar_content %}
                <div class="sidebar-widget">
                    <h4>Quick Stats</h4>
                    <ul class="stats-list">
                        <li>Projects: {{ projects | default([]) | length }}</li>
                        <li>Messages: {{ unread_messages | default(0) }}</li>
                        <li>Tasks: {{ pending_tasks | default(0) }}</li>
                    </ul>
                </div>
            {% endblock %}
        {% endembed %}
    </aside>
</div>
{% endblock %}

{# Additional blocks #}
{% block javascripts %}
{{ parent() }}
<script>
// JavaScript embedded in Twig template
document.addEventListener('DOMContentLoaded', function() {
    console.log('Twig template loaded successfully!');
    console.log('User: {{ user.name | json_encode | raw }}');
    console.log('Navigation items: {{ navigation | length }}');

    // Dynamic content based on Twig variables
    {% if user.active %}
    console.log('User is active - enabling interactive features');
    {% endif %}
});
</script>
{% endblock %}

{# Custom filters and functions demonstration #}
{% set processed_data = {
    'filtered_navigation': navigation | filter(item => item.active),
    'total_items': navigation | length,
    'has_active_items': navigation | filter(item => item.active) | length > 0,
    'sorted_projects': projects | default([]) | sort((a, b) => a.title <=> b.title)
} %}

{# Debug information (only in development) #}
{% if app.debug %}
<div class="debug-info" style="background: #f0f0f0; padding: 1rem; margin: 1rem 0; border: 1px solid #ccc;">
    <h4>Debug Information</h4>
    <pre>{{ processed_data | json_encode(constant('JSON_PRETTY_PRINT')) }}</pre>
</div>
{% endif %}
