<# ************************************************************************* #>
<#                                                                           #>
<#  test_codebase_jinja.txt                              TTTTTTTT SSSSSSS II #>
<#                                                          TT    SS      II #>
<#  By: st93642@students.tsi.lv                             TT    SSSSSSS II #>
<#                                                          TT         SS II #>
<#  Created: Sep 29 2025 00:16 st93642                      TT    SSSSSSS II #>
<#  Updated: Sep 29 2025 00:16 st93642                                       #>
<#                                                                           #>
<#   Transport and Telecommunication Institute - Riga, Latvia                #>
<#                       https://tsi.lv                                      #>
<# ************************************************************************* #>

{# Jinja2 Template - Python Templating Engine #}
{# Comprehensive template demonstrating Jinja2 features #}

{# Template variables and data structures #}
{% set page_title = "Welcome to Jinja2 Templates" %}
{% set user = {
    'name': 'John Doe',
    'email': 'john@example.com',
    'role': 'Developer',
    'active': true
} %}
{% set navigation = [
    {'url': '/', 'title': 'Home', 'active': true},
    {'url': '/about', 'title': 'About', 'active': false},
    {'url': '/contact', 'title': 'Contact', 'active': false}
] %}

{# Macro definitions #}
{% macro render_navigation(items) %}
{# Navigation menu macro #}
<nav class="navbar">
    <ul class="nav-list">
    {% for item in items %}
        <li class="nav-item{% if item.active %} active{% endif %}">
            <a href="{{ item.url }}" class="nav-link">{{ item.title }}</a>
        </li>
    {% endfor %}
    </ul>
</nav>
{% endmacro %}

{% macro user_card(user_data) %}
{# User information card macro #}
<div class="user-card">
    <h3>{{ user_data.name }}</h3>
    <p><strong>Email:</strong> {{ user_data.email }}</p>
    <p><strong>Role:</strong> {{ user_data.role }}</p>
    <p><strong>Status:</strong>
        {% if user_data.active %}
            <span class="status active">Active</span>
        {% else %}
            <span class="status inactive">Inactive</span>
        {% endif %}
    </p>
</div>
{% endmacro %}

{# Template inheritance - extending base template #}
{% extends "base.html" %}

{# Block definitions #}
{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<div class="container">
    {# Page header with filters #}
    <header class="page-header">
        <h1>{{ page_title | upper }}</h1>
        <p class="subtitle">{{ page_title | lower | replace('welcome to', 'Exploring') }}</p>
    </header>

    {# Navigation using macro #}
    {{ render_navigation(navigation) }}

    {# Main content area #}
    <main class="main-content">
        {# Conditional rendering #}
        {% if user.active %}
            <div class="welcome-message">
                <h2>Welcome back, {{ user.name | title }}!</h2>
                <p>It's great to see you again. Here's your dashboard:</p>
            </div>
        {% else %}
            <div class="inactive-message">
                <h2>Account Inactive</h2>
                <p>Please contact support to reactivate your account.</p>
            </div>
        {% endif %}

        {# User information using macro #}
        {{ user_card(user) }}

        {# Data iteration and filtering #}
        <section class="data-section">
            <h3>Recent Activities</h3>
            <ul class="activity-list">
            {% for activity in activities | selectattr('visible') | list %}
                <li class="activity-item">
                    <span class="activity-date">{{ activity.date | strftime('%Y-%m-%d') }}</span>
                    <span class="activity-description">{{ activity.description }}</span>
                    {% if activity.urgent %}
                        <span class="urgent-badge">URGENT</span>
                    {% endif %}
                </li>
            {% else %}
                <li class="no-activities">No recent activities found.</li>
            {% endfor %}
            </ul>
        </section>

        {# Form handling example #}
        <section class="form-section">
            <h3>Contact Form</h3>
            <form method="post" action="/contact">
                {{ csrf_input | safe }}
                <div class="form-group">
                    <label for="name">Name:</label>
                    <input type="text" id="name" name="name" value="{{ form.name | default('') }}" required>
                </div>
                <div class="form-group">
                    <label for="email">Email:</label>
                    <input type="email" id="email" name="email" value="{{ form.email | default('') }}" required>
                </div>
                <div class="form-group">
                    <label for="message">Message:</label>
                    <textarea id="message" name="message" rows="5">{{ form.message | default('') }}</textarea>
                </div>
                <button type="submit" class="btn btn-primary">Send Message</button>
            </form>
        </section>

        {# Advanced features demonstration #}
        <section class="advanced-features">
            <h3>Jinja2 Advanced Features</h3>

            {# Namespace for organizing variables #}
            {% set ns = namespace(counter=0, total=0) %}

            {# Loop with indexing and cycle #}
            <div class="feature-grid">
            {% for item in ['Feature A', 'Feature B', 'Feature C', 'Feature D'] %}
                {% set ns.counter = ns.counter + 1 %}
                <div class="feature-item {{ loop.cycle('odd', 'even') }}">
                    <h4>{{ item }}</h4>
                    <p>Item #{{ loop.index }} of {{ loop.length }}</p>
                    {% if loop.first %}<span class="badge">First</span>{% endif %}
                    {% if loop.last %}<span class="badge">Last</span>{% endif %}
                </div>
            {% endfor %}
            </div>

            {# Mathematical operations and formatting #}
            <div class="calculations">
                <h4>Calculations</h4>
                <p>Counter: {{ ns.counter }}</p>
                <p>Items per page: {{ items_per_page | default(10) }}</p>
                <p>Total pages: {{ (ns.counter / items_per_page) | round | int }}</p>
                <p>Percentage: {{ (ns.counter / 100 * 100) | round(2) }}%</p>
            </div>
        </section>
    </main>

    {# Sidebar with includes #}
    <aside class="sidebar">
        {% include 'sidebar.html' %}
    </aside>
</div>
{% endblock %}

{# Additional blocks #}
{% block scripts %}
<script>
// JavaScript embedded in Jinja template
document.addEventListener('DOMContentLoaded', function() {
    console.log('Jinja template loaded successfully!');
    console.log('User: {{ user.name | tojson }}');
});
</script>
{% endblock %}

{# Custom filters and tests demonstration #}
{% if 'admin' is in user.roles | default([]) %}
    {% set admin_panel = true %}
{% endif %}

{# Complex expressions #}
{% set complex_data = {
    'items': navigation | selectattr('active') | list,
    'count': navigation | length,
    'has_active': navigation | selectattr('active') | list | length > 0
} %}

{# Final output debugging (commented out in production) #}
{# {{ complex_data | tojson(indent=2) }} #}
